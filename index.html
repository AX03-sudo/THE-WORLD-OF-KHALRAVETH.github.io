<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Chronicles of Khalraveth</title>

    <!-- Fonts: Cinzel (Headers), Crimson Text (Readable), Pinyon Script (Cursive), Courier Prime (Tech) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400&family=Pinyon+Script&family=Courier+Prime&display=swap" rel="stylesheet">

    <!-- KaTeX (Math Rendering) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <!-- Tailwind CSS (for layout utility) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Marked.js (for Markdown parsing) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        /* --- DYNAMIC THEME VARIABLES --- */
        :root {
            /* --- DEFAULT: PARCHMENT (LIGHT) --- */
            --desk-bg: #1a120b; /* Dark Wood */
            --page-bg: #f4e8d1; /* Parchment */
            --sidebar-bg: #2c241b; /* Leather */

            --ink-primary: #2b2218; /* Dark Brown Ink */
            --ink-faded: #5c4d3c; /* Faded Ink */
            --ink-border: #dcd0b9; /* Border color */

            --rubric-red: #8b1c1c; /* Manuscript Red */
            --illumination-gold: #b8860b; /* Gold Leaf */

            /* Font Variables */
            --font-header: 'Cinzel Decorative', cursive;
            --font-cursive: 'Pinyon Script', cursive;
            --font-readable: 'Crimson Text', serif;
            --font-tech: 'Courier Prime', monospace;

            /* Default Body Font (Cursive) */
            --font-body: var(--font-cursive);
            --body-size: 1.5rem; /* Larger size for cursive readability */
        }

        /* --- DARK THEME OVERRIDES (MYSTIC PURPLE) --- */
        [data-theme="dark"] {
            --desk-bg: #100518; /* Deep Abyss Purple */
            --page-bg: #1a0f24; /* Dark Violet Page */
            --sidebar-bg: #150a1f; /* Shadowed Violet */

            --ink-primary: #e6dff0; /* Moon-white/Lavender Text */
            --ink-faded: #9d8ca6; /* Muted Violet */
            --ink-border: #4a3061; /* Purple Border */

            --rubric-red: #ff70a6; /* Neon Pink/Magenta Accent */
            --illumination-gold: #b388eb; /* Amethyst Glow */
        }

        /* --- FONT OVERRIDES --- */
        [data-font="readable"] {
            --font-body: var(--font-readable);
            --font-header: var(--font-readable);
            --body-size: 1.25rem; /* Standard size for serif */
        }

        /* --- GLOBAL STYLES --- */
        body {
            background-color: var(--desk-bg);
            color: var(--ink-primary);
            font-family: var(--font-body);
            overflow-x: hidden;
            /* Transition for the whole page */
            transition: background-color 0.6s cubic-bezier(0.22, 1, 0.36, 1),
                        color 0.6s cubic-bezier(0.22, 1, 0.36, 1);

            /* Noise texture (Active in Light Mode) */
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.05'/%3E%3C/svg%3E");
        }

        /* Disable Noise in Dark Mode for static readability */
        [data-theme="dark"] body {
            background-image: none;
        }

        /* Universal Smooth Transition for Theme Elements */
        #content-wrapper, #sidebar, .nav-item, h1, h2, h3, p, li, blockquote, td, th, pre, .btn-toggle, #floating-menu-btn {
            transition: background-color 0.6s cubic-bezier(0.22, 1, 0.36, 1),
                        color 0.6s cubic-bezier(0.22, 1, 0.36, 1),
                        border-color 0.6s cubic-bezier(0.22, 1, 0.36, 1),
                        box-shadow 0.6s ease,
                        width 0.3s ease,
                        margin 0.3s ease,
                        transform 0.3s ease;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: var(--desk-bg); }
        ::-webkit-scrollbar-thumb {
            background: var(--sidebar-bg);
            border: 1px solid var(--illumination-gold);
            border-radius: 2px;
        }

        /* --- TYPOGRAPHY STYLING --- */

        .markdown-render h1 {
            font-family: var(--font-header);
            color: var(--rubric-red);
            font-size: 3rem;
            border-bottom: 2px double var(--illumination-gold);
            padding-bottom: 0.5rem;
            margin-top: 2rem;
            margin-bottom: 1.5rem;
            text-align: center;
            letter-spacing: 0.05em;
            line-height: 1.2;
        }

        .markdown-render h2 {
            font-family: var(--font-header);
            color: var(--ink-primary);
            font-size: 2rem;
            margin-top: 2.5rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--ink-faded);
            display: inline-block;
            padding-right: 2rem;
        }

        .markdown-render h3 {
            font-family: var(--font-header);
            color: var(--illumination-gold);
            font-size: 1.5rem;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            text-shadow: 1px 1px 0px rgba(0,0,0,0.1);
        }

        /* Body Text */
        .markdown-render p {
            line-height: 1.6;
            margin-bottom: 1.2rem;
            font-size: var(--body-size);
            color: var(--ink-primary);
            text-align: justify;
        }

        .markdown-render strong {
            color: var(--rubric-red);
            font-weight: 700;
        }

        .markdown-render em {
            color: var(--ink-faded);
            font-style: italic;
        }

        /* Lists */
        .markdown-render ul {
            list-style-type: none;
            padding-left: 2rem;
            margin-bottom: 1.5rem;
            border-left: 1px solid var(--illumination-gold);
        }
        .markdown-render ul li {
            position: relative;
            margin-bottom: 0.5rem;
            padding-left: 1rem;
            font-size: var(--body-size);
        }
        .markdown-render ul li::before {
            content: '❧';
            color: var(--rubric-red);
            position: absolute;
            left: -0.6rem;
            font-size: 1.2rem;
            top: 2px;
        }

        /* Blockquotes */
        .markdown-render blockquote {
            background: rgba(184, 134, 11, 0.1);
            border: 1px solid var(--illumination-gold);
            margin: 2rem 1rem;
            padding: 1.5rem 2.5rem;
            font-style: italic;
            font-family: var(--font-header);
            color: var(--ink-primary);
            position: relative;
            box-shadow: inset 0 0 20px rgba(184, 134, 11, 0.1);
        }

        [data-theme="dark"] .markdown-render blockquote {
             background: rgba(179, 136, 235, 0.1); /* Amethyst tint in dark mode */
             box-shadow: inset 0 0 20px rgba(179, 136, 235, 0.1);
        }

        .markdown-render blockquote::before {
            content: '❝';
            font-size: 3rem;
            position: absolute;
            top: -20px;
            left: 10px;
            color: var(--illumination-gold);
        }

        /* Tables */
        .markdown-render table {
            width: 100%;
            border-collapse: collapse;
            margin: 2rem 0;
            font-family: var(--font-tech);
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--ink-primary);
            box-shadow: 2px 2px 0px rgba(0,0,0,0.1);
        }
        .markdown-render th {
            background: var(--ink-primary);
            color: var(--page-bg);
            padding: 1rem;
            text-align: left;
            font-family: var(--font-header);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        .markdown-render td {
            padding: 0.8rem 1rem;
            border-bottom: 1px solid var(--ink-faded);
            border-right: 1px solid var(--ink-faded);
            color: var(--ink-primary);
        }
        .markdown-render tr:last-child td {
            border-bottom: none;
        }

        /* Code Blocks */
        .markdown-render pre {
            background: rgba(0,0,0,0.1);
            border: 1px dashed var(--ink-faded);
            padding: 1.5rem;
            overflow-x: auto;
            margin: 2rem 0;
            position: relative;
        }

        [data-theme="dark"] .markdown-render pre {
             background: rgba(0,0,0,0.3);
        }

        .markdown-render pre::before {
            content: "ARCHIVE RECORD //";
            position: absolute;
            top: 0;
            right: 0;
            background: var(--ink-primary);
            color: var(--page-bg);
            font-size: 0.7rem;
            padding: 2px 6px;
            font-family: var(--font-tech);
        }
        .markdown-render code {
            font-family: var(--font-tech);
            color: var(--rubric-red);
            font-weight: 600;
        }

        /* Horizontal Rules */
        .markdown-render hr {
            border: 0;
            height: 2px;
            background-image: linear-gradient(to right, transparent, var(--illumination-gold), transparent);
            margin: 3rem 0;
            position: relative;
        }
        .markdown-render hr::after {
            content: "§";
            position: absolute;
            left: 50%;
            top: -12px;
            transform: translateX(-50%);
            background: var(--page-bg);
            padding: 0 10px;
            color: var(--illumination-gold);
            font-size: 1.2rem;
            font-family: var(--font-header);
            transition: background-color 0.6s ease;
        }

        /* KaTeX Adjustment */
        .katex {
            font-size: 1.1em;
        }

        /* --- MOBILE OPTIMIZATIONS --- */
        @media (max-width: 768px) {
            :root {
                --body-size: 1.15rem !important; /* Smaller text on mobile */
            }

            /* Compact Header on Mobile */
            .markdown-render h1 {
                font-size: 2rem !important;
                margin-top: 1rem;
                line-height: 1.1;
            }
            .markdown-render h2 {
                font-size: 1.5rem !important;
                margin-top: 2rem;
            }

            /* Tighter Spacing */
            #content-wrapper {
                padding: 1.5rem !important;
                margin: 1rem auto !important;
            }

            /* Adjust Blockquotes */
            .markdown-render blockquote {
                margin: 1.5rem 0.5rem;
                padding: 1rem 1.5rem;
            }
            .markdown-render blockquote::before {
                font-size: 2.5rem;
                top: -15px;
            }

            /* Smaller Decorations */
            .corner-decoration {
                width: 30px;
                height: 30px;
            }

            /* Sidebar Layering & Sizing for Phone */
            #sidebar {
                z-index: 60;
                width: 100% !important; /* Full screen on mobile */
            }

            /* Prevent body scroll when menu open */
            body.menu-open {
                overflow: hidden;
            }
        }

        /* --- UI COMPONENTS --- */

        /* Sidebar */
        #sidebar {
            background: var(--sidebar-bg);
            border-right: 4px double var(--desk-bg);
            box-shadow: 5px 0 15px rgba(0,0,0,0.5);
            position: relative;
            z-index: 50;
            display: flex;
            flex-direction: column;
            width: 100%; /* Mobile default */
        }

        /* Desktop Width */
        @media (min-width: 768px) {
            #sidebar {
                width: 18rem; /* 72 tailwind */
            }

            /* Logic for Desktop Collapse */
            body.desktop-sidebar-closed #sidebar {
                margin-left: -18rem;
            }
        }

        /* Noise on sidebar (Light mode only) */
        #sidebar::before {
            content: "";
            position: absolute;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.6' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.05'/%3E%3C/svg%3E");
            pointer-events: none;
        }

        [data-theme="dark"] #sidebar::before {
            display: none;
        }

        .nav-item {
            cursor: pointer;
            padding: 15px 25px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-family: var(--font-header);
            font-size: 0.95rem;
            color: #a89f91;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--illumination-gold);
            padding-left: 30px;
        }

        .nav-item.active {
            border-left: 4px solid var(--illumination-gold);
            background: linear-gradient(90deg, rgba(184, 134, 11, 0.1) 0%, transparent 100%);
            color: var(--page-bg);
            text-shadow: 0 0 5px var(--illumination-gold);
        }

        /* Sub-Menu Styling */
        .sub-menu {
            background: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            animation: slideDown 0.3s ease-out;
        }

        .sub-menu-item {
            padding: 6px 20px 6px 40px;
            font-family: var(--font-tech); /* Archive style */
            font-size: 0.75rem;
            color: #888; /* Slightly darker than nav items */
            cursor: pointer;
            transition: color 0.2s, background-color 0.2s;
            display: block;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-left: 2px solid transparent;
        }

        .sub-menu-item:hover {
            color: var(--illumination-gold);
            background: rgba(255,255,255,0.02);
            border-left-color: var(--illumination-gold);
        }

        .sub-menu-item.indent {
            padding-left: 55px; /* H2 indentation */
            opacity: 0.8;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Content Area */
        #main-scroll {
            background-color: var(--desk-bg);
        }

        #content-wrapper {
            position: relative;
            background-color: var(--page-bg);
            box-shadow:
                0 0 5px rgba(0,0,0,0.2),
                0 0 20px rgba(0,0,0,0.5),
                inset 0 0 60px rgba(0,0,0,0.1);
            margin-top: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--ink-border);
            min-height: calc(100vh - 4rem);
        }

        /* Paper Grain (Light Mode Only) */
        #content-wrapper::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg width='200' height='200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='paper'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.04' numOctaves='5' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23paper)' opacity='0.15'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 0;
            transition: opacity 0.5s ease;
        }

        /* Hide paper grain in Dark Mode */
        [data-theme="dark"] #content-wrapper::before {
            opacity: 0;
        }

        .corner-decoration {
            position: absolute;
            width: 60px; height: 60px;
            border: 2px solid var(--illumination-gold);
            z-index: 10;
            transition: border-color 0.6s ease;
        }
        .corner-top-left { top: 20px; left: 20px; border-right: none; border-bottom: none; }
        .corner-top-right { top: 20px; right: 20px; border-left: none; border-bottom: none; }
        .corner-bottom-left { bottom: 20px; left: 20px; border-right: none; border-top: none; }
        .corner-bottom-right { bottom: 20px; right: 20px; border-left: none; border-top: none; }

        .markdown-render, footer {
            position: relative;
            z-index: 5;
        }

        /* Controls */
        .controls-container {
            padding: 1.5rem;
            border-top: 1px solid rgba(255,255,255,0.05);
            background: rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .btn-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px;
            border: 1px solid var(--illumination-gold);
            background: rgba(0,0,0,0.3);
            color: #a89f91;
            font-family: var(--font-header);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            overflow: hidden;
            position: relative;
        }

        .btn-toggle:hover {
            background: var(--illumination-gold);
            color: var(--desk-bg);
            box-shadow: 0 0 15px var(--illumination-gold);
        }

        /* Floating Menu Button */
        #floating-menu-btn {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 60px;
            height: 60px;
            background: var(--sidebar-bg);
            border: 2px solid var(--illumination-gold);
            border-radius: 50%;
            z-index: 100; /* Highest */
            color: var(--illumination-gold);
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        #floating-menu-btn:hover {
            transform: scale(1.1);
            background: var(--illumination-gold);
            color: var(--desk-bg);
        }

        /* Switch Animation Class */
        .spin-pop {
            animation: spinPop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes spinPop {
            0% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(0.9) rotate(180deg); }
            80% { transform: scale(1.05) rotate(360deg); }
            100% { transform: scale(1) rotate(360deg); }
        }

        .btn-icon {
            transition: transform 0.4s ease;
        }

    </style>
</head>
<body class="flex h-screen" data-theme="light" data-font="cursive">

    <!-- FLOATING MENU BUTTON -->
    <button id="floating-menu-btn" class="spin-pop">
        <!-- Default Hamburger -->
        <svg id="icon-menu" class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
        <!-- Close Icon (Hidden by default) -->
        <svg id="icon-close" class="w-8 h-8 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
    </button>

    <!-- SIDEBAR NAVIGATION -->
    <nav id="sidebar" class="fixed inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0 transition-transform duration-300">

        <!-- LOGO HEADER -->
        <div class="p-8 border-b border-[#3d3226] bg-[#231c15] flex flex-col items-center relative">
             <!-- Mobile Close Button (Top Left of Sidebar) -->
             <button id="sidebar-close-btn" class="absolute top-4 left-4 md:hidden text-[#888] hover:text-[#b8860b]">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
            </button>

            <!-- Scarred Sphere SVG Logo -->
            <svg width="120" height="120" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" class="mb-4 drop-shadow-[0_0_10px_rgba(184,134,11,0.5)]">
                <defs>
                    <radialGradient id="sphereGrad" cx="50%" cy="50%" r="50%" fx="50%" fy="50%">
                        <stop offset="0%" style="stop-color:#b8860b;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#2b2218;stop-opacity:1" />
                    </radialGradient>
                    <filter id="glow">
                        <feGaussianBlur stdDeviation="2.5" result="coloredBlur"/>
                        <feMerge>
                            <feMergeNode in="coloredBlur"/>
                            <feMergeNode in="SourceGraphic"/>
                        </feMerge>
                    </filter>
                </defs>
                <!-- The Sphere -->
                <circle cx="100" cy="100" r="80" fill="url(#sphereGrad)" stroke="#8b1c1c" stroke-width="2" />
                <!-- The Scar (Fracture) -->
                <path d="M100 20 L100 60 L120 80 L90 110 L110 140 L100 180" stroke="#1a120b" stroke-width="6" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M100 20 L100 60 L120 80 L90 110 L110 140 L100 180" stroke="#8b1c1c" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                <!-- Orbiting Debris -->
                <circle cx="40" cy="100" r="5" fill="#8b1c1c" filter="url(#glow)" />
                <circle cx="160" cy="80" r="3" fill="#8b1c1c" filter="url(#glow)" />
                <circle cx="130" cy="150" r="4" fill="#b8860b" filter="url(#glow)" />
            </svg>

            <h1 class="font-header text-xl text-center text-[#b8860b] tracking-widest uppercase">The Scarred<br>Sphere</h1>
            <p class="text-xs text-center text-[#888] font-serif italic mt-2">Est. 10,000 RA</p>
        </div>

        <!-- NAVIGATION -->
        <div id="chapter-list" class="flex-1 overflow-y-auto py-4">
            <!-- JS will populate chapters here -->
        </div>

        <!-- CONTROLS -->
        <div class="controls-container">
            <button id="theme-toggle" class="btn-toggle">
                <svg class="w-5 h-5 btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                <span>Theme: Light</span>
            </button>
            <button id="font-toggle" class="btn-toggle">
                <svg class="w-5 h-5 btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"></path></svg>
                <span>Font: Cursive</span>
            </button>
        </div>

    </nav>

    <!-- MAIN CONTENT -->
    <main class="flex-1 overflow-y-auto h-full w-full relative pt-16 md:pt-0" id="main-scroll">
        <div id="content-wrapper" class="max-w-4xl mx-auto p-8 md:p-16">
            <!-- Corner Decorations -->
            <div class="corner-decoration corner-top-left"></div>
            <div class="corner-decoration corner-top-right"></div>
            <div class="corner-decoration corner-bottom-left"></div>
            <div class="corner-decoration corner-bottom-right"></div>

            <!-- This is where the rendered Markdown appears -->
            <div id="display-area" class="markdown-render fade-in">
                <!-- Content injected by JS -->
            </div>

            <footer class="mt-24 pt-10 border-t-2 border-[#dcd0b9] text-center text-[#5c4d3c] font-serif text-sm italic" style="border-color: var(--ink-faded);">
                The Chronicles of Khalraveth &bull; Transcribed by Scribe GM Ahmad &bull; End of Page
            </footer>
        </div>
    </main>

    <!-- ================================================================================== -->
    <!-- === USER CONTENT AREA: PASTE YOUR MARKDOWN IN THE BLOCKS BELOW ================== -->
    <!-- ================================================================================== -->

    <!-- BLOCK 1: HISTORY -->
    <script type="text/markdown" id="md-history" data-title="I. The Fall of Golarion">
# The Book of the Fall of Golarion
### The Final Scripture of a Dying World

> **1.** And upon the last eve of mortal order, the heroes struck down Asus of the Bones, the Lich-King who drank the knowledge of ages.
> **2.** His skull split with a sound like a crown breaking, and in his ruin the Orb of Abaddon began to scream.
> **3.** For the phylactery of the Bone-Lord had been the final chain, and when it shattered, the seal groaned open.

## Chapter II - The Orb is Broken

**4.** And when the Orb cracked, the breath of the void escaped.
**5.** Light fled. Thought unraveled. The sky bent as paper set to flame.
**6.** A rift tore across the heavens, not as lightning, but as a wound.
**7.** And from the wound came the First Hoofbeat...

## Chapter III - The Four Centaurs Ride Upon Golarion

### I. Zharok the Void-Hoof Descends
The firmament blackened as a star died above Absalom. Zharok stepped from the corpse of that light—a colossus of collapsing nebulae. His hooves pressed upon the continents, and mountains bowed like sinners.

* Empires cracked as glass.
* Ley lines snapped like rotted rope.
* For Collapse does not conquer. Collapse fulfills its nature.

### II. Lithea Eclipshorn Breathes Her Shadow
Then a silence swallowed the prayers of a thousand temples. Lithea rose, pale as unspoken sorrow. Her shadow slithered across Avistan and Garund, and memories fell away as leaves in winter.

> _Kings forgot their crowns. Heroes forgot their names. Lovers forgot each other's faces. Even the dead forgot they were dead._

### III. Morbrax the Red Trampler Unmakes the World
Then the horizon burned red, though no fire was lit. Morbrax charged forth, hooves like furnaces of void. Where he ran, nations vanished without ash. He devours not life, but the place where life was.

### IV. Eliystria Starvewind Freezes Time
And the last light dimmed over Tian Xia. Eliystria drifted downward, thin as famine, cold as the death of ages. Her hooves touched the seas, and the oceans stilled forever. Clocks cracked. Prophecies fell silent.
    </script>

    <!-- BLOCK 2: RACES -->
    <script type="text/markdown" id="md-races" data-title="II. The Inheritors of Ruin">
# The Inheritors of Ruin
_Races of Khalraveth_

When the Four Centaurs trampled the world, they did not merely break stone; they rewrote the biology of survival. The races of old Golarion are gone. We who remain are their echoes—twisted, hardened, and changed by the trauma of the cosmos.

---

## The Kaelothi (Humans)
**Also known as:** _The Shard-Bearers, The Dust-Born_

> "We are not a single vessel, but a mosaic glued together with hope and fear." — Thalrani Proverb

When the Orb of Abaddon shattered, the souls of humanity were flayed apart. The **Kaelothi** are the result of those fragments finding one another again in the dark. They are a resilient people, defined not by their versatility, but by their **fragmentation**.

It is said that no Kaelothi soul is "new." Instead, their spirits are comprised of the dust of a thousand dead ancients. This manifests as the **"Phantom Ache"**—sudden, vivid memories of lives they never led.

---

## The Durok (Dwarves)
**Also known as:** _The Gravity-Bound, The Anchors_

Zharok the Void-Hoof pressed upon the continents with the weight of collapsing nebulae. The ancestors of the Dwarves were not crushed; they adapted. The **Durok** are shorter than their forebears but possess a terrifying density. Their skin resembles cracked, dried riverbeds, and their footsteps strike the earth with the sound of falling anvils.

| Trait | Description |
| :--- | :--- |
| **Lore Twist** | Possess a biological gravity field. They literally "anchor" reality around them. |
| **Weakness** | Uncomfortable in open sky; they feel like they might fall *up*. |
| **Heritage** | **Void-Anchor:** Bonus to Fortitude against Shove/Trip; increased Bulk limit. |

---

## The Aethri (Gnomes)
**Also known as:** _The Glitch-Folk_

The First World was "untangled back into raw possibility". The Aethri are the survivors of that dissolution. They are not whimsical; they are **unstable**. Their hair and eyes change color not by choice, but by mood or magical proximity.

* If they do not experience new sensations, they do not undergo "The Bleaching".
* They undergo **"The Static"**, where they literally dissolve into white noise and cease to exist.

---

## The Voros (Orcs)
**Also known as:** _The Furnace-Blooded_

Morbrax the Red Trampler devoured matter. The Voros are the descendants of those who survived by eating the ash left behind. They have evolved a hyper-metabolism that can consume *anything*—rotten meat, wood, even rocks—to fuel their rage. Their blood boils at a temperature that burns to the touch.
    </script>

    <!-- BLOCK 3: PHYSICS/TECHNICAL -->
    <script type="text/markdown" id="md-physics" data-title="III. Physics of the Echo">
# The Physics of the Echo
_Section 1 - Fundamentals and Regulator Fields_

K-Physics adheres to the principles of Quantum Field Theory but incorporates two continuous, planet-spanning regulator fields that dramatically modify the behavior of known interactions.

## 1. The Field Triplet ($\mathcal{T}$)

In MFI quantum mechanics, the three fundamental fields are quantized into associated gauge bosons, which are constantly mediating interactions at the Planck scale.

| Field ($\Phi$) | Corresponding Gauge Boson | Quantum Effect Mediated |
| :--- | :--- | :--- |
| **Mend Field ($\Phi_M$)** | **Mendon ($\psi_M$)** | Energy transfer, structural integrity, healing. Massless, Spin-1. |
| **Wither Field ($\Phi_W$)** | **Witheron ($\psi_W$)** | Entropy, kinetic decay, momentum transfer. High Diffusivity. |
| **Regulator Field ($\Phi_R$)** | **Regulon ($\psi_R$)** | Spacetime stability, dimension anchoring. Spin-0 (Scalar). |

### The Wither-Mass Effect
The Wither Field increases a body's resistance to acceleration. This manifests as a dynamic increase in inertial mass.

$$ m_I = m_G \cdot (1 + \beta \Phi_W \cdot |\mathbf{a}|) $$

**Effect:** Initiating movement or moving high-mass objects requires disproportionately greater applied force. The **Wither-Mass Effect** makes carrying heavy loads exponentially more taxing on biological systems.

## 2. Aetheric Flow Script (AFS)

AFS is the low-level, assembly-like language of the Runic Tradition. It is an imperative, flow-based language where instructions (RLGs) are physically chained together.

```javascript
// --- AFS Runtime Simulation: Kinetic Push Spell ---

const PROGRAM_MEMORY = [
  // Address 0: Program Entry Point (Inject 120 Mend Potential)
  ['FUSE', 'PM', '120'],

  // Address 1: Core Conversion (85% efficiency)
  ['REFLECT', '0.85'],

  // Address 2: Power Gate Check (Is PW >= 90?)
  ['EVAL', 'PW', '90'],

  // Address 3: Conditional Branch
  ['JUMP_IF', '6'],

  // Address 4: Failure Path (Safe Dissipation)
  ['CLEAVE', 'PW', '10'],
  ['HALT'],

  // Address 6: Success Path (Spell Execution)
  ['SHIFT', '0x2A_FoePosition'],
  ['HALT']
];
```

### 3. Exotic Materials

* **Mithral (Mi):** A $\Phi_M$ Superconductor. Allows Mend Field to flow with zero resistance.
* **Adamantine (Ad):** A Wither-Strain Buffer. Its lattice traps and neutralizes entropic strain.
* **Noqual (Nq):** A $\Phi_M$ Inhibitor. Repels all Mend Coherence Shells.
    </script>

    <!-- BLOCK 4: ADD YOUR OWN CHAPTER -->
    <script type="text/markdown" id="md-new-chapter" data-title="IV. New Chapter Template">
# New Chapter Title
## Subsection

Replace this text with your own Markdown content.
You can copy this entire `<script>` block and paste it below to create more chapters.
Just change the `id` and `data-title` attributes.

* You can use lists.
* **Bold text**.
* Tables.

> And even quotes.
    </script>

    <!-- ================================================================================== -->
    <!-- === END USER CONTENT AREA ======================================================== -->
    <!-- ================================================================================== -->


    <script>
        // --- LOGIC TO PARSE BLOCKS AND RENDER ---

        document.addEventListener('DOMContentLoaded', () => {
            const sidebarList = document.getElementById('chapter-list');
            const displayArea = document.getElementById('display-area');
            const floatingBtn = document.getElementById('floating-menu-btn');
            const sidebarCloseBtn = document.getElementById('sidebar-close-btn');
            const sidebar = document.getElementById('sidebar');
            const iconMenu = document.getElementById('icon-menu');
            const iconClose = document.getElementById('icon-close');

            // Toggles
            const themeBtn = document.getElementById('theme-toggle');
            const fontBtn = document.getElementById('font-toggle');
            const body = document.body;

            // --- MATH HELPER FUNCTIONS ---
            // We need to protect math from Marked.js parsing (e.g., underscores becoming italics)
            // Strategy: Replace math blocks with temporary placeholders, parse markdown, then restore math.

            let mathExpressions = [];

            function protectMath(text) {
                mathExpressions = []; // reset storage

                // 1. Protect Block Math $$...$$
                text = text.replace(/\$\$([\s\S]+?)\$\$/g, (match, tex) => {
                    mathExpressions.push({type: 'display', tex: tex});
                    return `%%%MATH_DISPLAY_${mathExpressions.length - 1}%%%`;
                });

                // 2. Protect Inline Math $...$
                // Negative lookahead to ensure we don't catch currency like $5.00 if user typed space
                // But for this purpose, we assume $...$ is math.
                text = text.replace(/\$((?:[^\r\n$]|\\.)+)\$/g, (match, tex) => {
                    mathExpressions.push({type: 'inline', tex: tex});
                    return `%%%MATH_INLINE_${mathExpressions.length - 1}%%%`;
                });

                return text;
            }

            function restoreMath(html) {
                return html.replace(/%%%MATH_(DISPLAY|INLINE)_(\d+)%%%/g, (match, type, index) => {
                    const expr = mathExpressions[index];
                    // Restore as delimiters for KaTeX auto-render to pick up
                    if (expr.type === 'display') return `$$${expr.tex}$$`;
                    return `$${expr.tex}$`;
                });
            }

            // --- NAVIGATION LOGIC ---
            // Find all markdown script blocks
            const scripts = document.querySelectorAll('script[type="text/markdown"]');

            scripts.forEach((script, index) => {
                const title = script.getAttribute('data-title') || `Chapter ${index + 1}`;
                const id = script.id;

                const btn = document.createElement('div');
                btn.className = 'nav-item';
                btn.textContent = title;
                btn.onclick = () => loadChapter(id, btn);

                sidebarList.appendChild(btn);

                // Load first chapter by default
                if (index === 0) {
                    loadChapter(id, btn);
                }
            });

            function loadChapter(id, activeBtn) {
                // 1. Clear old active states and submenus
                document.querySelectorAll('.nav-item').forEach(el => {
                    el.classList.remove('active');
                });
                document.querySelectorAll('.sub-menu').forEach(el => el.remove());

                // 2. Set active
                activeBtn.classList.add('active');

                // 3. Render Content
                const rawMarkdown = document.getElementById(id).innerHTML.trim();

                // Animate transition
                displayArea.style.opacity = '0';

                setTimeout(() => {
                    // --- PROCESS MARKDOWN WITH MATH ---
                    const protectedText = protectMath(rawMarkdown);
                    const htmlContent = marked.parse(protectedText);
                    const finalHtml = restoreMath(htmlContent);

                    displayArea.innerHTML = finalHtml;

                    // --- RENDER MATH ---
                    if (window.renderMathInElement) {
                        renderMathInElement(displayArea, {
                            delimiters: [
                                {left: '$$', right: '$$', display: true},
                                {left: '$', right: '$', display: false},
                                {left: '\\(', right: '\\)', display: false},
                                {left: '\\[', right: '\\]', display: true}
                            ],
                            throwOnError: false
                        });
                    }

                    // 4. Generate Sub-menu dynamically
                    const headers = displayArea.querySelectorAll('h1, h2');
                    if (headers.length > 0) {
                        const subMenu = document.createElement('div');
                        subMenu.className = 'sub-menu';

                        headers.forEach((header, index) => {
                            // Create ID for scrolling
                            const anchorId = 'header-' + index;
                            header.id = anchorId;

                            const link = document.createElement('div');
                            link.className = 'sub-menu-item';
                            link.textContent = header.textContent;

                            // Indent H2s
                            if (header.tagName === 'H2') {
                                link.classList.add('indent');
                            }

                            link.onclick = (e) => {
                                e.stopPropagation();
                                header.scrollIntoView({ behavior: 'smooth' });

                                // Close Menu on selection (Mobile Only)
                                if (window.innerWidth < 768) {
                                    toggleMenu();
                                }
                            };
                            subMenu.appendChild(link);
                        });

                        // Insert after the active button
                        activeBtn.after(subMenu);
                    }

                    displayArea.style.opacity = '1';

                    // Reset scroll
                    document.getElementById('main-scroll').scrollTop = 0;
                }, 200);
            }

            // --- UI LOGIC ---

            // Helper to animate button
            function triggerButtonAnim(btn) {
                const icon = btn.querySelector('svg');
                // Handle complex SVG structure in toggle btns vs simple in icon btns
                if(icon) {
                   icon.classList.remove('spin-pop');
                   void icon.offsetWidth; // trigger reflow
                   icon.classList.add('spin-pop');
                }
            }

            // --- UNIFIED MENU LOGIC ---
            function toggleMenu() {
                const isMobile = window.innerWidth < 768;
                const isSidebarOpenMobile = !sidebar.classList.contains('-translate-x-full');
                const isSidebarClosedDesktop = body.classList.contains('desktop-sidebar-closed');

                if (isMobile) {
                    // Mobile Toggle Logic
                    if (isSidebarOpenMobile) {
                        // Close it
                        sidebar.classList.add('-translate-x-full');
                        document.body.classList.remove('menu-open');
                        iconMenu.classList.remove('hidden');
                        iconClose.classList.add('hidden');
                    } else {
                        // Open it
                        sidebar.classList.remove('-translate-x-full');
                        document.body.classList.add('menu-open');
                        iconMenu.classList.add('hidden');
                        iconClose.classList.remove('hidden');
                    }
                } else {
                    // Desktop Toggle Logic
                    if (isSidebarClosedDesktop) {
                        // Open it
                        body.classList.remove('desktop-sidebar-closed');
                        iconMenu.classList.remove('hidden');
                        iconClose.classList.add('hidden'); // On desktop "hamburger" means menu is there, maybe keep hamburger?
                        // Actually, let's keep it consistent: X means "close sidebar", Hamburger means "open sidebar"
                         iconMenu.classList.add('hidden');
                         iconClose.classList.remove('hidden');
                    } else {
                        // Close it
                        body.classList.add('desktop-sidebar-closed');
                        iconMenu.classList.remove('hidden');
                        iconClose.classList.add('hidden');
                    }
                }
            }

            // Initial State Check for Icons (Desktop starts open)
            if (window.innerWidth >= 768) {
                 iconMenu.classList.add('hidden');
                 iconClose.classList.remove('hidden');
            }

            floatingBtn.addEventListener('click', toggleMenu);
            sidebarCloseBtn.addEventListener('click', toggleMenu);

            // Theme Toggle
            themeBtn.addEventListener('click', () => {
                triggerButtonAnim(themeBtn);
                const isDark = body.getAttribute('data-theme') === 'dark';
                const newTheme = isDark ? 'light' : 'dark';
                body.setAttribute('data-theme', newTheme);

                // Update Button Text
                const span = themeBtn.querySelector('span');
                span.textContent = newTheme === 'dark' ? 'Theme: Dark' : 'Theme: Light';
            });

            // Font Toggle
            fontBtn.addEventListener('click', () => {
                triggerButtonAnim(fontBtn);
                const isReadable = body.getAttribute('data-font') === 'readable';
                const newFont = isReadable ? 'cursive' : 'readable';
                body.setAttribute('data-font', newFont);

                // Update Button Text
                const span = fontBtn.querySelector('span');
                span.textContent = newFont === 'readable' ? 'Font: Easy' : 'Font: Cursive';
            });

            // Smooth transition style
            displayArea.style.transition = 'opacity 0.3s ease-in-out';
        });
    </script>
</body>
</html>
